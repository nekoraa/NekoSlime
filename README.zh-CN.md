好的，这是根据您的要求进行润色和重新排版的 NekoSlime 项目文档。

# NekoSlime VR 动作捕捉方案

[English](README.md) | 中文

---

## 简介

NekoSlime 是一套基于 ESP32、BMI160 和 AK09911C 传感器的开源 VR 动作捕捉方案。它与 SlimeVR 协议兼容，旨在为用户提供一套经济实惠的全身追踪（Full-Body Tracking）解决方案，以增强虚拟现实中的沉浸感与互动体验。

---

## 材料清单准备

要构建 NekoSlime 追踪器，您需要准备以下电子元件和材料。该清单为一个完整的五点追踪系统所需。

| 数量 | 组件 | 图片 |
| :--- | :--- | :--- |
| 6 | ESP32 迷你开发板 |  |
| 5 | BMI160 惯性测量单元 |  |
| 5 | AK09911C 磁力计 |  |
| 5 | TP4056 充电模块 |  |
| 5 | 锂电池 |  |
| 5+ | 开关（三角） |  |
| 5 | 3D 打印外壳 | |
| - | 焊接用导线（推荐使用不同颜色以作区分） | |

---

## 硬件连接

本节将详细介绍单个追踪器的组装和接线流程。请严格按照步骤操作，以确保传感器正常工作。总共需要制作 5 个这样的从机追踪器和 1 个仅包含 ESP32 的主机。

**第 1 步：连接电池与充电模块**
将电池的正负极分别焊接到充电模块的 `B+` 和 `B-` 焊盘上。



**第 2 步：定位传感器**
将 BMI160 和 AK09911C 传感器并排摆放在 ESP32 开发板的背面。
**注意：** 传感器的位置和方向至关重要。请务必将 BMI160 对齐 ESP32 的上半部分，并确保两个传感器之间紧密对齐。建议使用双面胶临时固定。



**第 3 步：连接 BMI160 电源 (VCC)**
从 ESP32 的 `3V3` (3.3V) 引脚引出一条线，连接到 BMI160 传感器的 `VCC` 引脚。



**第 4 步：连接 BMI160 地线 (GND)**
从 ESP32 的 `GND` 引脚引出一条线，连接到 BMI160 传感器的 `GND` 引脚。



**第 5 步：连接 BMI160 时钟线 (SCL)**
从 BMI160 的 `SCL` 引脚引出一条线。这条线稍后将连接到 ESP32。



**第 6 步：连接 BMI160 数据线 (SDA)**
从 BMI160 的 `SDA` 引脚引出一条线。这条线稍后也将连接到 ESP32。



**第 7 步：连接 AK09911C 地线 (GND)**
将 AK09911C 传感器的 `GND` 引脚连接到 BMI160 的 `GND` 引脚（或直接连接到 ESP32 的 `GND`）。



**第 8 步：连接 I2C 总线到 ESP32**
将之前从两个传感器引出的 `SCL` 和 `SDA` 线连接到 ESP32。
*   **SCL** -> **GPIO 22**
*   **SDA** -> **GPIO 21**
**建议：** 此处推荐使用较细的“飞线”，便于布线和焊接。



**第 9 步：连接 AK09911C 电源 (VCC)**
将 AK09911C 的 `VCC` 引脚连接到 ESP32 的 `3V3` (3.3V) 引脚。



**第 10 步：连接 AK09911C 复位引脚 (RST)**
将 AK09911C 的 `RST` 引脚连接到 ESP32 的 `3V3` (3.3V) 引脚。
**注意：** 这是确保传感器正常初始化的关键一步，否则可能导致传感器无法被识别。



**第 11 步：检查接线**
完成以上步骤后，请仔细检查所有连接是否正确、牢固。最终的接线效果应如下图所示。



**第 12 步：组装外壳和开关**
将组装好的电路板和电池装入 3D 打印外壳。
*   **固定电路板：** 使用热熔胶将电路板平整地固定在外壳底部。

    
*   **固定充电模块：** 将充电模块固定在预留的开口处，确保 USB 端口朝外。

    
*   **安装开关：**
    1.  将开关安装到外壳预留的孔位。

        
    2.  将连接电池正极的红线和连接 ESP32 `VIN` 的另一条红线穿过开关孔。

        
    3.  将电池的供电线（正极）剪断，一端连接到开关的中间引脚，另一端连接到开关的一个侧边引脚。
    4.  将充电模块的 `OUT+` 连接到开关的输入端，`OUT-` 连接到 ESP32 的 `GND`。
    5.  将开关的输出端连接到 ESP32 的 `VIN` (5V) 引脚。

                        

**第 13 步：批量制作**
重复以上所有步骤，完成全部 5 个从机追踪器的制作。



---

## 固件安装

### 1. 使用 Thonny 刷入 MicroPython

首先，您需要为所有的 ESP32 开发板刷入 MicroPython 固件。我们推荐使用 Thonny IDE 来完成这个步骤。

**详细步骤：**

1.  **下载并安装 Thonny：** 如果您尚未安装，请从 [Thonny 官网](https://thonny.org/) 下载并安装。
2.  **下载 MicroPython 固件：**
    *   访问 [MicroPython 下载页面](https://micropython.org/download/)。
    *   选择 “ESP32” 开发板的固件，下载最新的稳定版 `.bin` 文件。
3.  **连接 ESP32：** 将您的一个 ESP32 开发板通过 USB 数据线连接到电脑。
4.  **配置 Thonny 解释器：**
    *   在 Thonny 中，转到 **工具 > 选项...**。
    *   选择 **解释器** 选项卡。
    *   从解释器下拉列表中选择 **MicroPython (ESP32)**。
    *   选择您的 ESP32 对应的 COM 端口。如果找不到，您可能需要为您的开发板安装 USB-to-UART 驱动程序（如 CP210x 或 CH340）。
5.  **安装固件：**
    *   仍在解释器设置中，点击“**安装或更新 MicroPython**”。
    *   在弹出的窗口中，选择正确的目标端口，并浏览选择您之前下载的 `.bin` 文件。
    *   点击“安装”开始刷写固件。
    *   当该过程完成后，您会在 Thonny 的 Shell 中看到 MicroPython 的 REPL 提示符 (`>>>`)。
6.  **为所有开发板重复操作：** 为您的全部六个 ESP32 开发板（1个主机，5个从机）重复此过程。

### 2. 主机 ESP32 设置 (1个)

主机 ESP32 负责从所有追踪器收集数据并将其发送到您的电脑。

1.  在 Thonny 中打开 `host_main.py` 文件。
2.  **配置网络设置：**
    *   在 `host_main.py` 中找到网络配置部分（约在第 36-37 行）。
    *   您需要填写您的 Wi-Fi 信息和运行 SlimeVR 服务器的电脑的 IP 地址。
        *   `WIFI_SSID`: 您的 Wi-Fi 网络名称。
        *   `WIFI_PASSWORD`: 您的 Wi-Fi 密码。
        *   `PC_IP`: 您电脑的局域网 IP 地址。
        *   `PC_PORT`: NekoSlime 接收程序使用的端口号（默认为 12345）。
3.  **上传文件：** 将修改后的 `host_main.py` 保存到主机 ESP32。

### 3. 从机 ESP32 设置 (5个)

从机 ESP32 负责读取传感器数据并将其发送到主机。

1.  **连接一个从机 ESP32** 到您的电脑。
2.  **使用 Thonny 将以下文件上传**到 ESP32：
    *   `ak09911.py`
    *   `bim160.py`
    *   `boot.py`
    *   `fusion.py`
    *   `main.py`
3.  **配置追踪器 ID：**
    *   在 Thonny 中打开上传好的 `main.py` 文件。
    *   找到 `TRACKER_ID=x` 这一行。
    *   **关键一步：您必须为每个追踪器分配一个从 0 到 4 的唯一 ID。** 例如，第一个追踪器设置为 `TRACKER_ID=0`，第二个设置为 `TRACKER_ID=1`，以此类推。
4.  **重复操作：** 为所有五个从机 ESP32 重复这些步骤，确保每个都有唯一的 `TRACKER_ID`。

---

## 软件安装

PC 端的软件接收来自主机 ESP32 的追踪数据，并将其转发给 SlimeVR 服务器。

1.  **先决条件：** 如果您希望直接运行 Python 脚本，请确保您的 PC 上已安装 Python 环境。
2.  **选择您的运行方式：**
    *   **使用 Python 脚本：** 直接运行 `NekoSlime接收程序.py`。
    *   **使用可执行文件：** 为了方便使用，您可以直接运行 `dist` 文件夹中的 `NekoSlime接收程序.exe`。
3.  **与 SlimeVR 的集成：** 在连接 NekoSlime 接收程序**之前**，请确保 SlimeVR 服务器正在您的 PC 上运行。

---

## 运行

1.  打开您所有的 ESP32 追踪器和主机 ESP32 的电源。
2.  在您的电脑上启动 SlimeVR 服务器。
3.  在您的电脑上运行 NekoSlime 接收程序（.py 或 .exe）并点击“连接”。
4.  此时，您应该能在 SlimeVR 服务器窗口中看到新的追踪器出现。校准后，您就可以在 VR 应用中享受全身追踪了！
